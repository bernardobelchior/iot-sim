<script type="text/javascript">
  (function() {
    RED.nodes.registerType("test-runner", {
      category: "Testing",
      color: "#a6bbcf",
      defaults: {
        name: { value: "test-runner" },
        flow: { value: "", required: true},
        outputs: {value: 1, required: true},
      },
      inputs: 1,
      icon: "switch.png",
      label: function() {
        return this.name || "Test Runner";
      },
      oneditprepare: function() {
        const flows = new Set();
        RED.nodes.eachNode(n => flows.add(n.z));

        flows.forEach(flowId => {
          $("#node-input-flow").append("<option value='" + flowId + "'>" + flowId + "</option>");
        });
      }
    });
  })();
</script>

<script type="text/x-red" data-template-name="test-runner">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-flow"><i class="icon-tag"></i> Flow</label>
        <select id="node-input-flow" name="flow" placeholder="Flow">
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-outputs"><i class="icon-tag"></i> Outputs</label>
        <input id="node-input-outputs" type="number" name="outputs" placeholder="Outputs" value="1"/>
    </div>
</script>

<script type="text/x-red" data-help-name="test-runner">
    <p>Runs tests sequentially. Every test starts with a "test-start" node and ends with a "test-end" node.
    Only one "test-start" can be connected to an output, otherwise inconsistencies may occur.
    Only one "test-runner" can be present in a flow at a given time.
    <b>In order to start the test runner, a message with payload "start_tests" must be sent to it.</b>
    This can be done using an Inject node.
    </p>
</script>
